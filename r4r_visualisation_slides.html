<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>R for Archaeologists</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# R for Archaeologists
]
.subtitle[
## Visualisation
]

---

class: middle
background-image: url("figures/jr-survey.png")
background-size: 67%




.pull-left[
![](https://joeroe.io/images/avatar.png)

**Joe Roe**  
University of Bern  

* <svg aria-hidden="true" role="img" viewBox="0 0 640 512" style="height:1em;width:1.25em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"/></svg> [joeroe.io](https://joeroe.io)
* <svg aria-hidden="true" role="img" viewBox="0 0 496 512" style="height:1em;width:0.97em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> [joeroe](https://github.com/joeroe)
* <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> [@joeroe](https://twitter.com/joeroe90)
]

.pull-right[
![](figures/jr-palecomod.png)
![](figures/jr-c14.png)
]

???

* Introducing myself

---
class: center, middle

<div id="rzgmsikhtb" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#rzgmsikhtb .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rzgmsikhtb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rzgmsikhtb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rzgmsikhtb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rzgmsikhtb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rzgmsikhtb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rzgmsikhtb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rzgmsikhtb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rzgmsikhtb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rzgmsikhtb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rzgmsikhtb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rzgmsikhtb .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#rzgmsikhtb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rzgmsikhtb .gt_from_md > :first-child {
  margin-top: 0;
}

#rzgmsikhtb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rzgmsikhtb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rzgmsikhtb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rzgmsikhtb .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rzgmsikhtb .gt_row_group_first td {
  border-top-width: 2px;
}

#rzgmsikhtb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rzgmsikhtb .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rzgmsikhtb .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rzgmsikhtb .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rzgmsikhtb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rzgmsikhtb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rzgmsikhtb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rzgmsikhtb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rzgmsikhtb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rzgmsikhtb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rzgmsikhtb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rzgmsikhtb .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rzgmsikhtb .gt_left {
  text-align: left;
}

#rzgmsikhtb .gt_center {
  text-align: center;
}

#rzgmsikhtb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rzgmsikhtb .gt_font_normal {
  font-weight: normal;
}

#rzgmsikhtb .gt_font_bold {
  font-weight: bold;
}

#rzgmsikhtb .gt_font_italic {
  font-style: italic;
}

#rzgmsikhtb .gt_super {
  font-size: 65%;
}

#rzgmsikhtb .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#rzgmsikhtb .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rzgmsikhtb .gt_indent_1 {
  text-indent: 5px;
}

#rzgmsikhtb .gt_indent_2 {
  text-indent: 10px;
}

#rzgmsikhtb .gt_indent_3 {
  text-indent: 15px;
}

#rzgmsikhtb .gt_indent_4 {
  text-indent: 20px;
}

#rzgmsikhtb .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-weight: bold;" scope="col">Day</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-weight: bold;" scope="col">Time</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-weight: bold;" scope="col">Topics</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-weight: bold;" scope="col">Exercises</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="font-size: small; text-align: left; vertical-align: top; font-weight: bold;"><div class='gt_from_md'><p>Monday</p>
</div></td>
<td class="gt_row gt_left" style="font-size: small; text-align: left; vertical-align: top; font-weight: bold;"><div class='gt_from_md'><p>10–13</p>
</div></td>
<td class="gt_row gt_left" style="font-size: small; text-align: left; vertical-align: top;"><div class='gt_from_md'><p><strong>Introduction to visualisation in R</strong></p>
<ul>
<li>Visualisation in data science</li>
<li>Overview of R graphics packages</li>
<li>ggplot2: The 'grammar of graphics'</li>
</ul>
</div></td>
<td class="gt_row gt_left" style="font-size: small; text-align: left; vertical-align: top;"><div class='gt_from_md'><p><em>R for Data Science</em>, ch. 3</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="font-size: small; text-align: left; vertical-align: top; font-weight: bold;"><div class='gt_from_md'></div></td>
<td class="gt_row gt_left" style="font-size: small; text-align: left; vertical-align: top; font-weight: bold;"><div class='gt_from_md'><p>14–17</p>
</div></td>
<td class="gt_row gt_left" style="font-size: small; text-align: left; vertical-align: top;"><div class='gt_from_md'><p><strong>Visualisation for Exploratory Data Analysis</strong></p>
<ul>
<li>Applications in archaeology</li>
<li>Visualising 'tidy data'</li>
<li><code>ggplot2</code> for EDA</li>
</ul>
</div></td>
<td class="gt_row gt_left" style="font-size: small; text-align: left; vertical-align: top;"><div class='gt_from_md'><p><em>R for Data Science</em>, ch. 7 &amp; 11</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="font-size: small; text-align: left; vertical-align: top; font-weight: bold;"><div class='gt_from_md'><p>Tuesday</p>
</div></td>
<td class="gt_row gt_left" style="font-size: small; text-align: left; vertical-align: top; font-weight: bold;"><div class='gt_from_md'><p>10–13</p>
</div></td>
<td class="gt_row gt_left" style="font-size: small; text-align: left; vertical-align: top;"><div class='gt_from_md'><p><strong>Advanced visualisation exercises</strong></p>
<ul>
<li>Tables: <code>gt</code></li>
<li>Radiocarbon: <code>ggridges</code></li>
<li>Cartography: <code>ggspatial</code></li>
<li>3D: <code>rayshader</code></li>
</ul>
</div></td>
<td class="gt_row gt_left" style="font-size: small; text-align: left; vertical-align: top;"><div class='gt_from_md'><p><em>Groupwork</em></p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="font-size: small; text-align: left; vertical-align: top; font-weight: bold;"><div class='gt_from_md'></div></td>
<td class="gt_row gt_left" style="font-size: small; text-align: left; vertical-align: top; font-weight: bold;"><div class='gt_from_md'><p>14–17</p>
</div></td>
<td class="gt_row gt_left" style="font-size: small; text-align: left; vertical-align: top;"><div class='gt_from_md'><p><strong>Publication-ready visualisation</strong></p>
<ul>
<li>What makes an effective graphic?</li>
<li>Advanced <code>ggplot2</code>: aesthetics and themes</li>
<li>Tips for the real world</li>
</ul>
</div></td>
<td class="gt_row gt_left" style="font-size: small; text-align: left; vertical-align: top;"><div class='gt_from_md'><p><em>R for Data Science</em>, ch. 28</p>
</div></td></tr>
  </tbody>
  
  
</table>
</div>

???

* The "Visualisation" module follows on from the introduction to R you've had so far
* We'll start by outlining the through the two major graphics packages in R: "base" and `ggplot2`
* 
* Then tomorrow, we'll look at some specific "advanced" visualisation techniques relevant to archaeology:
  * First spatial visualisations and mapping, following on from last week's module on spatial analysis
  * Then a selection of other specific applications – subject to change!
* And finally, on Wednesday, we'll discuss preparing plots ready for final publication
* I would like this to be as hands-on as possible, so the format for this module is you doing exercises at your own pace, with me dropping in to explain things as needed

---
class: center, middle

View these slides online:  
&lt;https://joeroe.io/r4r_visualisation/r4r_visualisation_slides.html&gt;

Source code:  
&lt;https://github.com/joeroe/r4r_visualisation&gt;

&lt;small&gt;They're written in RMarkdown!&lt;/small&gt;

---
class: inverse, center, middle

# Visualisation with R
## Introduction

???

* Why use R for visualisations? Or: why did we devote a quarter of this course to visualisation?
* Most of you are probably here because, in some way or other, you want to use R to "do statistics"
* As you go up the admittedly steeper learning curve of visualisations in R, you might ask: why not just export the result to a more intuitive programme like Excel, and make the plots there?
* For that I have three answers:
  * (or four: the zeroth being because Excel is bad software, don't use it)

---
class: center, middle

![](figures/data-science.png)

.center[&lt;small&gt;Data science workflow. After Wickham &amp; Grolemund, *R for Data Science*&lt;/small&gt;]

???

* First—and this is why we are we looking at visualisations now, rather than at the end—is that visualisation is not just the end product of a statistical analysis, something you use to **communicate**, but right at its centre, as something that helps us **understand**.
* In the exploratory data analysis (EDA) or modern "data science" workflow (illustrated very nicely here in a figure from Hadley Wickham's *R for Data Science*), visualisation is one of the pillars of data analysis
* You should use graphics often, to help you understand data as you go through the iterative cycle of interrogating and modelling it

---
class: center, middle

.pull-left[
![](figures/tukey-eda.jpg)
]

.pull-right[
![](figures/r4ds.jpg)
]

???

* This is an old idea: starting with 'exploratory data analysis', and continued in modern 'data science'
* Computers obviously make it a lot easier to generate plots quickly;
* And R was in fact originally designed to facilitate EDA, so it's very well suited for it: once you've mastered the basic graphics functions, you can generate plots easily and often

---
class: middle

# R: a statistical *programming language*

1. Iterate
2. Scale
3. Reproduce

???

* Second, R is a statisical *programming language*. This has powerful advantages compared to traditional workflows for producing plots:
  * Iteration: generate your final plot and realise you need to change something in the source data? No problem!
  * Scalability: write code to visualise X about Y; then run it on 1000 (or 10000, or 100000) values of Y
  * Reproducibility: everybody can see exactly the steps you took to produce a plot

---
class: center, middle

## `bbplot` &lt;&lt;https://github.com/bbc/bbplot&gt;&gt;

![](figures/bbplot_example_plots.png)

???

* Third, R graphics simply do look very nice. Maybe not always 'out of the box', but the capability is there.
* For example, ... all use R for their statistical graphics

---

# Graphics packages in R


```r
library("archdata")
data("BACups")
```

.pull-left[
&lt;img src="r4r_visualisation_slides_files/figure-html/plot-demo-base-1.png" width="100%" /&gt;

```r
plot(BACups$H, BACups$RD)
```
]

.pull-right[
&lt;img src="r4r_visualisation_slides_files/figure-html/plot-demo-ggplot-1.png" width="100%" /&gt;

```r
ggplot(BACups, aes(x = H, y = RD)) +
  geom_point()
```
]

???

* There isn't one way to produce plots in R: you have to pick a **graphics package**
* The main options are "base" (actually `graphics`), `ggplot2`, and `lattice` (now rarely used)
* These packages have major differences in syntax, and by extension flexibility and capabilities

---

.pull-left[
&lt;img src="r4r_visualisation_slides_files/figure-html/plot-demo-base-ext-1.png" width="100%" /&gt;

```r
par(mfrow = c(1,2))
plot(BACups[BACups$Phase=="Protoapennine",]$H,
     BACups[BACups$Phase=="Protoapennine",]$RD,
     cex = BACups[BACups$Phase=="Protoapennine",]$ND / 10,
     main = "Bronze Age cups",
     sub = "Protoapennine",
     xlab = "Height",
     ylab = "Rim Diameter")
plot(BACups[BACups$Phase=="Subapennine",]$H,
     BACups[BACups$Phase=="Subapennine",]$RD,
     cex = BACups[BACups$Phase=="Subapennine",]$ND / 10,
     main = "(Data from Lukesh and Howe 1978)",
     sub = "Subapennine",
     xlab = "Height",
     ylab = "Rim Diameter")
legend("bottomright", 
       title = "Neck Diameter", 
       pch = 1,
       legend = c(10, 15, 20, 25), 
       pt.cex = c(1, 1.5, 2, 2.5))
```
]

.pull-right[
&lt;img src="r4r_visualisation_slides_files/figure-html/plot-demo-ggplot-ext-1.png" width="100%" /&gt;

```r
ggplot(BACups, aes(x = H, y = RD, size = ND)) +
  geom_point(shape = 1) +
  facet_wrap(vars(Phase)) +
  labs(x = "Height", 
       y = "Rim Diameter", 
       size = "Neck Diameter",
       title = "Bronze Age cups", 
       subtitle = "Data from Lukesh and Howe (1978)")
```
]

???

* These differences are highlighted when you try to do more complex plots
* Don't get hung up on the aesthetic differences – these are defaults, you can easily make one look like the other (or anything else)
* There is some debate over the pros and cons of each – I see ggplot2 as a straightforward upgrade and from this afternoon we will focus on its approach
* But it's helpful to be familiar with base as the 'default' in a lot of cases, e.g. used by many packages to plot complex data structures, so we'll start with that

---
class: inverse, center, middle

# `ggplot2`: the 'grammar of graphics'

???

* `ggplot2` is based on the "grammar of graphics"
* This is a somewhat theoretical concept. Further reading: 
  * Wickham 2010, *A Layered Grammar of Graphics*
  * Wilkinson, Anand &amp; Grossman 2005, *The Grammar of Graphics*
* But it's helpful to have some idea of that theory, to make sense of random prefixes like "aes" or "geom"

---
class: center, middle

# The Grammar of Graphics

![](figures/grammar-of-graphics.png)

???

* The grammer is a structured way of *describing* the relationship between data and graphical elements (declarative) – as opposed to `base` graphics, which is you *telling* R what to plot (imperative)
* Specifically, `ggplot` introduces a *layered* grammer of graphics, allowing you to combine multiple mappings into a single plot
* This makes it much more flexible than base and allows us to maintain readable code for even very complicated plots
* Downsides: data does have to be in a roughly tabular (if not fully "tidy") structure to work well with ggplot. Complex objects from other packages can be a challenge to work with.
  * For EDA purposes, it's often better to fall back on `base::plot()` with these objects
  * Though packages like `broom` can help


---

# Plotting with `ggplot2`: exercises

**Wickham &amp; Grolemund, *R for data science***

https://r4ds.had.co.nz/

Chapter 3: *Data visualisation*

Chapter 7: *Exploratory Data Analysis* (if you have time)

* Install the `tidyverse` metapackage
* Run Hadley's code examples
* Answer questions as comments (`# Here is my answer...`)
* Do the 'exercises' sections – they're very informative!

---

# Plotting with `ggplot2`: applications?

.pull-left[
&lt;img src="r4r_visualisation_slides_files/figure-html/ggplot-scatter-1.png" width="100%" /&gt;
&lt;img src="r4r_visualisation_slides_files/figure-html/ggplot-smooth-1.png" width="100%" /&gt;
]

.pull-right[
&lt;img src="r4r_visualisation_slides_files/figure-html/ggplot-bar-1.png" width="100%" /&gt;
&lt;img src="r4r_visualisation_slides_files/figure-html/ggplot-boxplot-1.png" width="100%" /&gt;
]

???

* We've seen how to do a few fundamental plots with ``ggplot2` this morning, but using "dummy" datasets like `cars` and `diamonds`. 
* What are some archaeological applications of these plots?
* Tomorrow we will look at some more niche types of visualisation in archaeology;
* For now, we continue to work on the fundamentals of using visualisation EDA

---
class: middle

# Tidy data

![](figures/r4rds-tidy-1.png)

???

* As I mentioned this morning, a big part of producing graphics effectively is having the tools to transform data to the right format
* And `ggplot2` is generally super-charged when used as part of a "tidy data analysis" workflow
* With the example data you've used so far, this has been done for you. With "real world" archaeology data, it won't be!

---

# Plotting with tidy data

.pull-left[

```r
data("emedyd") # From rcarbon
emedyd %&gt;% 
  filter(SiteName == "Wadi Jilat 13") %&gt;% 
  arrange(CRA) %&gt;% 
  mutate(LabID = as_factor(LabID)) %&gt;% 
  mutate(CalDate = cal(CRA, Error, verbose = FALSE)) %&gt;% 
  unnest_legacy() %&gt;% 
  ggplot(aes(calBP, PrDens)) +
  facet_wrap(~LabID, ncol = 1, 
             scales = "free_y", 
             strip.position = "left") +
  geom_area() + 
  scale_x_reverse(name = "cal BP") +
  scale_y_continuous(labels = NULL, name = NULL) +
  labs(title = "Wadi Jilat 13",
      subtitle = "Radiocarbon chronology")
```
]

.pull-right[
&lt;img src="r4r_visualisation_slides_files/figure-html/tidy-rcarbon-1.png" width="100%" /&gt;
]

???

* For example, *pipes* allow us to elegantly and concisely load data, clean and filter, and plot in a single code block
* Half of the code here—the most important half—is *reshaping* the data before even giving it to the plot. Often, it's more than half!
* You can read more about reshaping or "wrangling" data in *R for Data Science*

---

# `ggplot2` for EDA: exercises

**Wickham &amp; Grolemund, *R for data science***

https://r4ds.had.co.nz/

Chapter 3: *Data visualisation* (if you haven't finished)  
Chapter 7: *Exploratory Data Analysis*  
Chapter 12: *Tidy data* (if you have time)

* Run Hadley's code examples
* Answer questions as comments (`# Here is my answer...`)
* Do the 'exercises' sections – they're very informative!

---
class: inverse, center, middle

# Advanced visualisations
## Plotting archaeological data

---
class: inverse, center, middle

# CartogRaphy
## Mapping with `ggplot2` and friends

---
class: center, middle

# R as a GIS
## (R isn't a GIS)

---

# R spatial ecosystem

.pull-left[
* Spatial data
  * `rgdal`, `rgeos`, `rgrass7`, `link2gi`
  * `sf`, `sp`
  * `raster`, `stars`, `terra`
* Geostatistics
  * `spatstat`, `gstat`, `spdep`, `nlme`
  * `landsat`, `dismo`
]
.pull-right[
* Base maps + open data
  * `maps`, `maptools`, `rnaturalearth`
  * `ggmap`, `leaflet`, `mapview`
  * `rOpenSci`
* Cartography
  * `ggplot2`
  * `ggspatial`
  * `rasterVis`
  * `tmap`
]

---

# Mapping with `ggplot2`: exercises (1/2)

**Wickham, Navarro &amp; Pedersen, *ggplot2: Elegant Graphics for Data Analysis***

https://ggplot2-book.org/

Chapter 6: *Maps*

* Run the code examples
* Reproduce the following using the 'tavo-a27' dataset.
  * Hint: In addition to `ggplot2`, you will need the `raster` and `ggspatial` packages.
  
---
class: center, middle


&lt;img src="r4r_visualisation_slides_files/figure-html/eg-tavo-1.png" width="100%" /&gt;

---

# Tables (`gt`)
## The forgotten visualisation

<div id="npzqtpzxze" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#npzqtpzxze .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#npzqtpzxze .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#npzqtpzxze .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#npzqtpzxze .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#npzqtpzxze .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#npzqtpzxze .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#npzqtpzxze .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#npzqtpzxze .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#npzqtpzxze .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#npzqtpzxze .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#npzqtpzxze .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#npzqtpzxze .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#npzqtpzxze .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#npzqtpzxze .gt_from_md > :first-child {
  margin-top: 0;
}

#npzqtpzxze .gt_from_md > :last-child {
  margin-bottom: 0;
}

#npzqtpzxze .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#npzqtpzxze .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#npzqtpzxze .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#npzqtpzxze .gt_row_group_first td {
  border-top-width: 2px;
}

#npzqtpzxze .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#npzqtpzxze .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#npzqtpzxze .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#npzqtpzxze .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#npzqtpzxze .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#npzqtpzxze .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#npzqtpzxze .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#npzqtpzxze .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#npzqtpzxze .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#npzqtpzxze .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#npzqtpzxze .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#npzqtpzxze .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#npzqtpzxze .gt_left {
  text-align: left;
}

#npzqtpzxze .gt_center {
  text-align: center;
}

#npzqtpzxze .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#npzqtpzxze .gt_font_normal {
  font-weight: normal;
}

#npzqtpzxze .gt_font_bold {
  font-weight: bold;
}

#npzqtpzxze .gt_font_italic {
  font-style: italic;
}

#npzqtpzxze .gt_super {
  font-size: 65%;
}

#npzqtpzxze .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#npzqtpzxze .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#npzqtpzxze .gt_indent_1 {
  text-indent: 5px;
}

#npzqtpzxze .gt_indent_2 {
  text-indent: 10px;
}

#npzqtpzxze .gt_indent_3 {
  text-indent: 15px;
}

#npzqtpzxze .gt_indent_4 {
  text-indent: 20px;
}

#npzqtpzxze .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <td colspan="11" class="gt_heading gt_title gt_font_normal" style>Composition of Romano-British Pottery</td>
    </tr>
    <tr>
      <td colspan="11" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style>Data: Tubb et al. (1980) in Baxter (2003)</td>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1" scope="col">Kiln</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="2" colspan="1" scope="col">Sites</th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="9" scope="colgroup">
        <span class="gt_column_spanner">Mean composition</span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">Al2O3</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">Fe2O3</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">MgO</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">CaO</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">Na2O</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">K2O</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TiO2</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">MnO</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">BaO</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr class="gt_group_heading_row">
      <td colspan="11" class="gt_group_heading">Gloucester</td>
    </tr>
    <tr class="gt_row_group_first"><td class="gt_row gt_left">Gloucester</td>
<td class="gt_row gt_right">22</td>
<td class="gt_row gt_right">16.94%</td>
<td class="gt_row gt_right">7.43%</td>
<td class="gt_row gt_right">1.84%</td>
<td class="gt_row gt_right">0.94%</td>
<td class="gt_row gt_right">0.35%</td>
<td class="gt_row gt_right">3.11%</td>
<td class="gt_row gt_right"><sup class="gt_footnote_marks gt_asterisk">*</sup> 0.90%</td>
<td class="gt_row gt_right">0.07%</td>
<td class="gt_row gt_right">0.02%</td></tr>
    <tr class="gt_group_heading_row">
      <td colspan="11" class="gt_group_heading">Wales</td>
    </tr>
    <tr class="gt_row_group_first"><td class="gt_row gt_left" style="font-weight: bold;">Llanedeyrn</td>
<td class="gt_row gt_right" style="font-weight: bold;">14</td>
<td class="gt_row gt_right" style="font-weight: bold;">12.56%</td>
<td class="gt_row gt_right" style="font-weight: bold;">6.37%</td>
<td class="gt_row gt_right" style="font-weight: bold;">4.83%</td>
<td class="gt_row gt_right" style="font-weight: bold;">0.20%</td>
<td class="gt_row gt_right" style="font-weight: bold;">0.25%</td>
<td class="gt_row gt_right" style="font-weight: bold;"><sup class="gt_footnote_marks gt_asterisk">*</sup> 3.93%</td>
<td class="gt_row gt_right" style="font-weight: bold;">0.71%</td>
<td class="gt_row gt_right" style="font-weight: bold;"><sup class="gt_footnote_marks gt_asterisk">*</sup> 0.14%</td>
<td class="gt_row gt_right" style="font-weight: bold;">0.02%</td></tr>
    <tr><td class="gt_row gt_left">Caldicot</td>
<td class="gt_row gt_right">2</td>
<td class="gt_row gt_right">11.70%</td>
<td class="gt_row gt_right">5.42%</td>
<td class="gt_row gt_right">3.85%</td>
<td class="gt_row gt_right">0.29%</td>
<td class="gt_row gt_right">0.05%</td>
<td class="gt_row gt_right">4.57%</td>
<td class="gt_row gt_right">0.57%</td>
<td class="gt_row gt_right">0.10%</td>
<td class="gt_row gt_right">0.01%</td></tr>
    <tr class="gt_group_heading_row">
      <td colspan="11" class="gt_group_heading">New Forest</td>
    </tr>
    <tr class="gt_row_group_first"><td class="gt_row gt_left">Islands Thorns</td>
<td class="gt_row gt_right">5</td>
<td class="gt_row gt_right">18.18%</td>
<td class="gt_row gt_right">1.71%</td>
<td class="gt_row gt_right">0.67%</td>
<td class="gt_row gt_right">0.03%</td>
<td class="gt_row gt_right">0.05%</td>
<td class="gt_row gt_right">2.08%</td>
<td class="gt_row gt_right">1.05%</td>
<td class="gt_row gt_right">0.00%</td>
<td class="gt_row gt_right">0.02%</td></tr>
    <tr><td class="gt_row gt_left">Ashley Rails</td>
<td class="gt_row gt_right">5</td>
<td class="gt_row gt_right">17.32%</td>
<td class="gt_row gt_right">1.51%</td>
<td class="gt_row gt_right">0.61%</td>
<td class="gt_row gt_right">0.05%</td>
<td class="gt_row gt_right">0.05%</td>
<td class="gt_row gt_right">1.97%</td>
<td class="gt_row gt_right">0.99%</td>
<td class="gt_row gt_right">0.00%</td>
<td class="gt_row gt_right">0.02%</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="11"><sup class="gt_footnote_marks gt_asterisk">*</sup> May contain an error.</td>
    </tr>
  </tfoot>
</table>
</div>

???

* Tables are often overlooked as a substitute for a plot, but actually they can be a very effective visualisation.
* For example Tufte advises that if you have a bar plot with less than 5 (?) bars... use a table!
* Or a 
* R is table-oriented, but for publication we might want to break the "tidy" rules and do things like merge cells, add style, etc.
* The new `gt` package from RStudio is excellent for this, and uses a ggplot2-like grammar

---

# Radiocarbon

.pull-left[
![:scale 70%](figures/shubayqa1-radiocarbon.jpg)
.center[&lt;small&gt;Richter et al. 2017&lt;/small&gt;]
]

.pull-right[
![](figures/bronk-ramsey-spd.jpeg)
.center[&lt;small&gt;Bronk Ramsey 2017&lt;/small&gt;]
]

---

# Radiocarbon packages in R

* Databases
  * `c14bazAAR`
* Calibration
  * `rcarbon`
  * `oxcAAR` (interface for OxCal)
  * `Bchron`
* Modelling
  * `rcarbon`
  * `stratigraphr`
  * `ArchaeoPhases`

---


```
## # A tibble: 1,915 × 10
##    LabID      CRA Error Material  Species SiteN…¹ Country Longi…² Latit…³ Region
##    &lt;chr&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; 
##  1 AA-1164   9100   140 charcoal  Pisum   'Ain G… JO         36.0    32.0 1     
##  2 AA-1167   8570   180 charcoal  &lt;NA&gt;    'Ain G… JO         36.0    32.0 1     
##  3 AA-25037  8775    75 charcoal  &lt;NA&gt;    'Ain G… JO         36.0    32.0 1     
##  4 AA-25424  8030    65 charcoal… &lt;NA&gt;    'Ain G… JO         36.0    32.0 1     
##  5 AA-25425  8080    65 charcoal  &lt;NA&gt;    'Ain G… JO         36.0    32.0 1     
##  6 AA-25426  8205    65 charcoal  &lt;NA&gt;    'Ain G… JO         36.0    32.0 1     
##  7 AA-25427  7910    60 charcoal  &lt;NA&gt;    'Ain G… JO         36.0    32.0 1     
##  8 AA-25428  7910    60 charcoal  &lt;NA&gt;    'Ain G… JO         36.0    32.0 1     
##  9 AA-25429  7980    55 seeds (c… Lens    'Ain G… JO         36.0    32.0 1     
## 10 AA-5196   7670   100 charcoal  &lt;NA&gt;    'Ain G… JO         36.0    32.0 1     
## # … with 1,905 more rows, and abbreviated variable names ¹​SiteName, ²​Longitude,
## #   ³​Latitude
```

.pull-left[

```r
emedyd %&gt;% 
  filter(SiteName == "Wadi Jilat 13") %&gt;% 
  arrange(CRA) %&gt;% 
  mutate(LabID = as_factor(LabID)) %&gt;% 
  mutate(CalDate = c14_calibrate(CRA, Error, verbose = FALSE)) %&gt;% 
  unnest_legacy() %&gt;% 
  ggplot(aes(year, p)) +
  facet_wrap(~LabID, ncol = 1, 
             scales = "free_y", 
             strip.position = "left") +
  geom_area() + 
  scale_x_reverse() +
  labs(title = "Wadi Jilat 13",
       subtitle = "Radiocarbon chronology",
       x = "cal BP") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text.y.left = element_text(angle = 0, hjust = 0))
```
]
.pull-right[
&lt;img src="r4r_visualisation_slides_files/figure-html/eg-rcarbon-1.png" width="100%" /&gt;
]

---
class: center, middle

# 3D (`rayshader` &amp; `rayrender`)

![:scale 50%](figures/rayrendersmall.jpg)

???

* These two packages are introducing rayshaded 3D models to R
* 3D can be a 'touchy subject' in data viz., but there are different kins:
  * Bad 3D: purely decorative
  * Dodgy 3D: functional, but usually better options, e.g. 3D scatterplots
  * Good 3D: things that are 3D, e.g. objects, topography
* E.g. ...
  
---
class: center, middle

![](figures/raisz-cuba.jpeg)

.center[&lt;small&gt;Gerardo Canet &amp; Erwin Raisz, *Atlas de Cuba* (1949)&lt;/small&gt;]

???

* ... these beautiful topographic maps by Erwin Raisz
* Which can now be modernised with rayrender ...

---
class: center, middle
![](figures/rzvr-3d.png)

---

.pull-left[
&lt;img src="r4r_visualisation_slides_files/figure-html/eg-tavo-1.png" width="100%" /&gt;
&lt;img src="r4r_visualisation_slides_files/figure-html/tidy-rcarbon-1.png" width="100%" /&gt;
]

.pull-right[
![](figures/archdata_table.png)
![](figures/rzvr-3d.png)
]

???

* Today's exercise: form groups and try to recreate one of these visualisations.

---
class: inverse, center, middle

# Publication-ready visualisations
## With `ggplot2` and friends

---
class: center, middle

# Effective visualisations: Tufte's principles

Above all else show data.

Maximize the data-ink ratio.

Erase non-data-ink.

Erase redundant data-ink.

Revise and edit.

---
class: center, middle

![:scale 30%](figures/tufte-worst-chart.jpg)
&gt; The worst graphic ever to find its way into print
&gt; – Tufte 

---




```r
tufte_data %&gt;% 
  filter(age_group == "&lt;25") %&gt;% 
  ggplot(aes(x = year, y = enrollment)) +
  geom_line() +
  scale_y_continuous(limits = c(0, 1), labels = percent) +
  labs(title = "Enrollment under 25") +
  theme_minimal()
```

&lt;img src="r4r_visualisation_slides_files/figure-html/tufte-graphic-improved-1.png" width="70%" /&gt;

???

R nudges you into making good graphics (as opposed to Excel!)

---

# Publication-ready visualisation: exercises

**Wickham &amp; Grolemund, *R for data science***

https://r4ds.had.co.nz/

Chapter 28: *Graphics for communication*

* Run Hadley's code examples
* Answer questions as comments (`# Here is my answer...`)
* Do the 'exercises' sections – they're very informative!

---

# Tips for the real world

.pull-left[
* Getting your data in the right shape is half the battle (at least)
* (Semantic) colour is dangerous; try facets
  * Five colours max; three is better
  * Pretend you have to use black and white, even if you don't
* Don't worry about aesthetics and output formats until you need to
* ...but don't ignore them either!
]
.pull-right[
* Tables are great, but `gt` support for PDF is still limited
* `cowplot` for publication-quality figures
* Colour schemes: `RColorBrewer` &lt;&lt;https://colorbrewer2.org/&gt;&gt;, `khroma`, `rcartocolor`
* `patchwork` for composing multi-panel figures
* If you can use it, animation is powerful (`gganimate`)
* Annotating ggplots is frustrating, but `ggrepel`, `directlabels` and `ggforce` help
]

---

# Further reading

.pull-left[
### R/tidyverse

* Wickham &amp; Grolemund, *R for Data Science*, &lt;https://r4ds.had.co.nz/&gt;
  * Also recommends lots of good books!
* RStudio cheatsheets, &lt;https://rstudio.com/resources/cheatsheets/&gt;

### ggplot2

* Wickham, Navarro &amp; Pedersen, *ggplot2: Elegant Graphics for Data Analysis* (3rd ed.), &lt;https://ggplot2-book.org/&gt;
* Chang, *R Graphics Cookbook*, &lt;https://r-graphics.org/&gt;
* The R Graph Gallery, &lt;https://www.r-graph-gallery.com/&gt;
* Wickham 2010, *A Layered Grammar of Graphics*
* Wilkinson, Anand &amp; Grossman 2005, *The Grammar of Graphics*
]
 
.pull-right[
* Tufte 1983, *The Visual Display of Quantitative Information* 

### Cartography

* Lovelace, Nowosad &amp; Muenchow, *Geocomputation with R*, &lt;https://geocompr.robinlovelace.net/index.html&gt;
* Robinson 1953, *Elements of Cartography* 

### Extensions

* Marwick et al. 2017, *Packaging Data Analytical Work Reproducibly Using R (and Friends)*, https://doi.org/10.1080/00031305.2017.1375986
* Wickham 2020, *Mastering `Shiny`*, https://mastering-shiny.org/
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="libs/scale-macro.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:10",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
